<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>

<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<META name="GENERATOR" content="IBM WebSphere Studio Homepage Builder Version 7.0.0.0 for Windows">
<META http-equiv="Content-Style-Type" content="text/css">
<title>OAMSoftEmu_Overview</title>
<LINK rel="stylesheet" href="../../css/nitro.css" type="text/css">
</head>

<body>
<h1 align="left">OAMソフトウエアスプライト描画モジュール</h1>
<H2>説明</H2>
OAMをソフトウエアスプライトを使用して、簡単に描画できる機能を提供するモジュールです。<BR>

<h2>OAMソフトウェアスプライト描画のメリット</h2>
OAMマネージャをソフトウェアスプライト表示用に使用する場合には、以下に示すようなメリットがあります。

<h3>OAMと同じ使い勝手</h3>
    2DグラフィックスエンジンのOAMを引数にとるＡＰＩが用意されていますので、NITROの３Ｄグラフィックスエンジンを意識することなく、ソフトウェアスプライトを用いた描画を行う事が出来ます。
<h3>OAMの制限を回避</h3>
    最大表示数、2倍以上の拡大表示制限などの制限が回避可能となります。
    
<h3>UVパラメータのキャッシングによる高速な描画</h3>
    OAMソフトウエアスプライト描画モジュールは通常、描画毎にOAMアトリビュートを解釈してUVパラメータの計算を行います。
    OAMソフトウエアスプライト描画モジュールは、このUVパラメータ計算処理を、キャッシュして再計算を回避することで、高速に描画を行う機能を提供しています。

<h2>OAMソフトウェアスプライト描画に関する注意事項</h2>
OAMソフトウエアスプライト描画モジュールでは、ソフトウェアスプライトを用いる場合においても、2DグラフィックスエンジンのOAMと同様の使い方ができるように設計されています。
しかし、2Dグラフィックスエンジンと３Ｄグラフィックスエンジンとのハードウェア機能の違いにより、完全な互換性を持たせることは出来ません。


<h3>キャラクタデータの違い</h3>
2DグラフィックスエンジンのOBJ用のキャラクタデータと、ソフトウェアスプライトが使用するテキスチャデータとは、そのフォーマットとVRAM上での置き場所が異なります。その為、OBJ用のキャラクタデータとは別にソフトウェアスプライト用のキャラクタデータが必要となります。

<h3>Affine行列のスケールの違い</h3>
2DグラフィックスエンジンのOBJに用いられるAffine行列のスケールは、ソフトウェアスプライト（ポリゴン）で用いられるAffine行列のスケールと異なった解釈を行います。OBJで２倍に拡大されるように設定した行列は、ソフトウェアスプライトでは２分の１に縮小するように機能します。

<h3>Affine変換パラメータ番号指定</h3>
OAMアトリビュート内でAffine行列番号とフリップフラグは同じビット情報を共有利用しています。<br>
通常、両者の区別は回転拡大縮小イネーブルフラグの状態から行います。<br>
しかし、ソフトウエアスプライト描画ならではの機能(例：アフィン変換したOBJをフリップ描画する)を実現するために、
本モジュールでは、回転拡大縮小イネーブルフラグの判定を行いません。<br>
そのため、Affine変換パラメータ番号に8以上の値を設定した場合、<br>
パラメータ番号がフリップフラグと誤認されてしまいます。<br>
<br>
本モジュールを単体で利用する場合には、Affine変換パラメータ番号を指定する必要はないため問題にはなりませんが、
OAMマネージャのソフトウェアスプライト描画機能を利用される場合には、注意が必要となります。

<h3>アルファ値の扱い</h3>
本モジュールは、３Ｄグラフィックスエンジンのアルファ値の状態を制御しません。<br>
３Ｄグラフィックスエンジンは、アルファ値をゼロに指定した場合、ポリゴンをワイヤーフレームで描画します。<br>
そのため、場合によっては、描画自体を行わない等の処理をユーザコードに記述する必要があります。<br>

<h3>モザイク機能</h3>
2DグラフィックスエンジンのOBJでは、OBJ単位でモザイク機能のオンとオフが設定できますが、ソフトウェアスプライトでは、ソフトウェアスプライト全体でしかモザイク機能のオンとオフが設定できません。

<h3>BGとの優先順位</h3>
2DグラフィックスエンジンのOBJでは、OBJ単位でBGとの優先順位が設定できますが、ソフトウェアスプライトでは、ソフトウェアスプライト全体でしか優先順位を指定できません。

<h3>フリップ機能を利用した場合のテクスチャサンプリング位置の補正</h3>
OAMソフトウエアスプライト描画モジュールはUV値補正関数を登録できるようになっています。
NITROの３Dグラフィックスエンジンはテクスチャサンプリング位置がLCD画素方向に対して、固定されているため、UVの増加方向が画素方向にたいして異なる場合、サンプリング位置がずれてしまいます。OAMソフトウエアスプライト描画モジュールではフリップ機能を利用したOBJの描画をUV値を反転することで再現しています。UV値を反転することで、UVの増加方向が逆転するのでUV値を補正する必要があります。
なお、アフィン変換を使用した際もUV値の増加方向が画素方向とずれ補正処理が必要です。しかし、この場合、補正計算の計算負荷が高くなることが予想され、素材側での対処が現実的であるとの判断からG2Dは補正手段をサポートしません。

<BR>
</p>

<h2>参照</h2>
<p>
なし
</p>
<H2>履歴</H2>
<P>2007/11/26 アルファ値に関する説明を追加</P>
<P>2004/12/06 初版</P>
</body>
</html>
